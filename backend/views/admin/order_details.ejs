<%- include('partials/header.ejs') %>

<style>
  .user-details-head {
    background: #212529 !important;
  }
  .user-details-head p {
    color: white;
  }
  .user-details-img {
    background-color: white !important;
    height: auto;
    margin: 0 auto;
    padding: 5px;
    overflow: hidden;
    position: absolute;
    border: 4px solid #212529;
    top: -22px;
    left: 17px;
  }
</style>

<div class="main-content">
  <section class="section">
    <div class="section-body">
      <div class="row">
        <!-- admin box -->
        <!-- <div class="col-md-4">
          <div class="card">
            <div class="card-header user-details-head">
              <div class="user-name">
                <h4><%-record.name%></h4>
                <p><b><%-record.mobile_number%></b></p>
              </div>
            </div>
            <div class="card-body position-relative p-5">
              <div class="user-details-img">
                <img
                  src="/uploads/profile/<%= record.image %>"
                  alt="<%= record.image %>"
                  style="width: 70px; height: auto"
                />
              </div>
            </div>
            <div class="card-footer mt-3" style="border-top: 1px solid #cdc3c3">
              <h6 class="pb-3">Available Balance</h6>
              <span><%= record.wallet %></span>
              <div class="mt-3 mb-2 row">
                <div class="col-md-6">
                  <button
                    class="btn btn-success w-100"
                    style="font-size: 12px"
                    type="submit"
                    data-bs-toggle="modal"
                    data-bs-target="#myModal"
                  >
                    Add Fund
                  </button>
                </div>
                <div class="col-md-6">
                  <button
                    class="btn btn-danger w-100"
                    style="font-size: 12px"
                    type="submit"
                    data-bs-toggle="modal"
                    data-bs-target="#myModal2"
                  >
                    Withdrawal Fund
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div> -->

        <!-- user -->
        <div class="col-md-12">
          <div class="card">
            <div class="card-header" style="background-color: #212529">
              <h4>Order Information</h4>
            </div>
            <div class="personal-information row m-2 pt-2">
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Full Name</b></h6>
                <span><%-record.fullname%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>

            <div
              class="personal-information row m-2 pt-2 pb-2"
              style="border-top: 1px solid #cdc3c3"
            >
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Mobile :</b></h6>
                <span><%-record.phone%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div
              class="personal-information row m-2 pt-2 pb-2"
              style="border-top: 1px solid #cdc3c3"
            >
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Email :</b></h6>
                <span><%-record.email%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div
              class="personal-information row m-2 pt-2 pb-2"
              style="border-top: 1px solid #cdc3c3"
            >
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Address :</b></h6>
                <span><%-record.house_no+', '+record.city+', '+record.postal_code+', '+record.region%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div
              class="personal-information row m-2 pt-2 pb-2"
              style="border-top: 1px solid #cdc3c3"
            >
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Oder Id :</b></h6>
                <span><%-record.order_id%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div
              class="personal-information row m-2 pt-2 pb-2"
              style="border-top: 1px solid #cdc3c3"
            >
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Amount :</b></h6>
                <span><%-record.amount%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div
              class="personal-information row m-2 pt-2 pb-2"
              style="border-top: 1px solid #cdc3c3"
            >
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Discount :</b></h6>
                <span><%-record.discount%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div
              class="personal-information row m-2 pt-2 pb-2"
              style="border-top: 1px solid #cdc3c3"
            >
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Grand Total :</b></h6>
                <span><%-record.grandTotal%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <!-- <div
              class="personal-information row m-2 pt-2 pb-2"
              style="border-top: 1px solid #cdc3c3"
            >
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Razor Signature :</b></h6>
                <span><%-record.razorpay_signature %></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div> -->
            <div
              class="personal-information row m-2 pt-2 pb-2"
              style="border-top: 1px solid #cdc3c3"
            >
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Razor Payment ID :</b></h6>
                <span><%-record.razorpay_payment_id%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
          </div>

          
        </div>
        <div class="col-md-12">
          <div class="card">
            <div class="card-header" style="background-color: #212529">
              <h4>Product Information</h4>
            </div>
            <div class="personal-information row m-2 pt-2">
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Full Name</b></h6>
                <span><%-prdInfo.cardUsrFirstName%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div class="personal-information row m-2 pt-2">
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Last Name</b></h6>
                <span><%-prdInfo.cardUsrLastName%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div class="personal-information row m-2 pt-2">
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Company Name</b></h6>
                <span><%-prdInfo.companyName%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div class="personal-information row m-2 pt-2">
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Selected Color</b></h6>
                <span><%-prdInfo.selectedColor%></span>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div class="personal-information row m-2 pt-2">
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Card Document</b></h6>
                <% if(!prdInfo.cardDocument) { %>
                  <span>No</span>
                  <% } else { %>
                    <span>
                      <a href="/uploads/cart/<%= prdInfo.cardDocument %>" target="_blank"><%= prdInfo.cardDocument %></a>
                     
                    </span>
                  <% } %>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div class="personal-information row m-2 pt-2">
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Company Logo</b></h6>
                <% if(!prdInfo.islogoAdded) { %>
                <span>No</span>
                <% } else { %>
                  <span>
                    <img
                              src="/uploads/cart/<%= prdInfo.companyLogo %>"
                              alt="slider"
                              height="100px"
                              width="100px"
                            />
                  </span>
                <% } %>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>
            <div class="personal-information row m-2 pt-2">
              <div class="col-md-6 d-flex justify-content-between">
                <h6><b>Spare Card Added</b></h6>
                <% if(!prdInfo.isSparePartAdded) { %>
                <span>No</span>
                <% } else { %>
                  <span>
                   Yes
                  </span>
                <% } %>
              </div>
              <div class="col-md-6 d-flex justify-content-between"></div>
            </div>

            
           
          </div>

          
        </div>
      </div>
    </div>
  </section>


</div>

<%
function convertTimeStampToDate(date){
   date = Number(date)
      var d = new Date(date),
         month = '' + (d.getMonth() + 1),
         day = '' + d.getDate(),
         year = d.getFullYear();

   if (month.length < 2)
   month = '0' + month;
   if (day.length < 2)
   day = '0' + day;
   var date = new Date();
   date.toLocaleDateString();

   return [day, month, year].join('-');
}
%>

<%- include ('partials/footer.ejs') %>
<script>
  $(document).ready(function () {
    $("#example1").DataTable();
  });
  $(document).ready(function () {
    $("#example2").DataTable();
  });
  $(document).ready(function () {
    $("#example3").DataTable();
  });
  $(document).ready(function () {
    $("#example4").DataTable();
  });
</script>
<script>
  function getFormData($form) {
    var unindexed_array = $form.serializeArray();
    var indexed_array = {};

    $.map(unindexed_array, function (n, i) {
      indexed_array[n["name"]] = n["value"];
    });

    return indexed_array;
  }
  var addform = $("#submitForm");
  addform.on("submit", submitFormHandler);

  function submitFormHandler(e) {
    e.preventDefault();
    if ($("input[name='amount']").val() == "") {
      renderToast({ message: "Please enter amount", icon: "error" });
      return false;
    }

    var formData = getFormData(addform);
    console.log(formData);

    $.ajax({
      type: "POST",
      contentType: "application/json",
      url: "/admin/users/add-fund",
      data: JSON.stringify(formData),
    })
      .done((res) => {
        console.log(res);
        if (res.error == true) {
          renderToast({ message: res.message, icon: "error" });
        } else {
          renderToast({ message: res.message, icon: "success" });
          setTimeout(() => {
            window.location.reload();
          }, 2000);
        }
      })
      .fail(function (xhr, status, error) {
        Snackbar.show({
          text: xhr.responseText,
          pos: "bottom-right",
          customClass: "snackbar-custom-d",
          showAction: false,
        });
      });
  }
</script>

<script>
  function getFormData($form) {
    var unindexed_array = $form.serializeArray();
    var indexed_array = {};

    $.map(unindexed_array, function (n, i) {
      indexed_array[n["name"]] = n["value"];
    });

    return indexed_array;
  }
  var submitform = $("#submitForm2");
  submitform.on("submit", submitFormHandler);

  function submitFormHandler(e) {
    e.preventDefault();

    var formData = getFormData(submitform);
    console.log(formData);

    $.ajax({
      type: "POST",
      contentType: "application/json",
      url: "/admin/users/withdraw-fund",
      data: JSON.stringify(formData),
    })
      .done((res) => {
        alert(res.message);
        if (res.error == true) {
          renderToast({ message: res.message, icon: "error" });
        } else {
          renderToast({ message: res.message, icon: "success" });
          setTimeout(() => {
            window.location.reload();
          }, 2000);
        }
      })
      .fail(function (xhr, status, error) {
        Snackbar.show({
          text: xhr.responseText,
          pos: "bottom-right",
          customClass: "snackbar-custom-d",
          showAction: false,
        });
      });
  }
</script>
